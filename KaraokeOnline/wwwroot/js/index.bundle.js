(()=>{var t={978:t=>{class s{constructor(){this.init()}init(){this.hOffset=0,this.vOffset=0,this.keyColor=null,this.bgColor=null,this.clut=new Array(16).fill([0,0,0]),this.pixels=new Uint8ClampedArray(this.WIDTH*this.HEIGHT).fill(0),this.buffer=new Uint8ClampedArray(this.WIDTH*this.HEIGHT).fill(0),this.imageData=new ImageData(this.WIDTH,this.HEIGHT),this.backgroundRGBA=[0,0,0,0],this.contentBounds=[0,0,0,0]}setCLUTEntry(t,s,e,o){this.clut[t]=[s,e,o].map((t=>17*t))}renderFrame({forceKey:t=!1}={}){const[s,e,o,r]=[0,0,this.WIDTH,this.HEIGHT];let[i,h,c,l]=[this.WIDTH,this.HEIGHT,0,0],n=!1;for(let a=e;a<r;a++)for(let e=s;e<o;e++){const s=(e-this.hOffset+this.WIDTH)%this.WIDTH+(a-this.vOffset+this.HEIGHT)%this.HEIGHT*this.WIDTH,o=this.pixels[s],[r,f,u]=this.clut[o],p=o===this.keyColor||t&&(o===this.bgColor||null==this.bgColor),H=4*(e+a*this.WIDTH);this.imageData.data[H]=r,this.imageData.data[H+1]=f,this.imageData.data[H+2]=u,this.imageData.data[H+3]=p?0:255,p||(n=!0,i>e&&(i=e),h>a&&(h=a),c<e&&(c=e),l<a&&(l=a))}this.contentBounds=n||!t?[i,h,c+1,l+1]:[0,0,0,0],this.backgroundRGBA=null===this.bgColor?[0,0,0,t?0:1]:[...this.clut[this.bgColor],this.bgColor===this.keyColor||t?0:1]}}s.prototype.WIDTH=300,s.prototype.HEIGHT=216,s.prototype.DISPLAY_WIDTH=288,s.prototype.DISPLAY_HEIGHT=192,s.prototype.DISPLAY_BOUNDS=[6,12,294,204],s.prototype.TILE_WIDTH=6,s.prototype.TILE_HEIGHT=12;class e{constructor(t){this.colors=[15&t[4],15&t[5]],this.row=31&t[6],this.column=63&t[7],this.pixels=t.slice(8,20)}execute(t){const s=this.column*t.TILE_WIDTH,e=this.row*t.TILE_HEIGHT;if(s+6>t.WIDTH||e+12>t.HEIGHT)console.log(`TileBlock out of bounds (${this.row},${this.column})`);else for(let o=0;o<12;o++){const r=this.pixels[o];for(let i=0;i<6;i++){const h=this.colors[r>>5-i&1],c=s+i+(e+o)*t.WIDTH;this.op(t,c,h)}}}op({pixels:t},s,e){t[s]=e}}class o{constructor(t){this.color=15&t[4];const s=63&t[5];this.hCmd=(48&s)>>4,this.hOffset=7&s;const e=63&t[6];this.vCmd=(48&e)>>4,this.vOffset=7&e}execute(t){t.hOffset=Math.min(this.hOffset,5),t.vOffset=Math.min(this.vOffset,11);let s=0;2===this.hCmd?s=t.TILE_WIDTH:1===this.hCmd&&(s=-t.TILE_WIDTH);let e,o,r=0;if(2===this.vCmd?r=t.TILE_HEIGHT:1===this.vCmd&&(r=-t.TILE_HEIGHT),0===s&&0===r)return;for(let i=0;i<t.WIDTH;i++)for(let h=0;h<t.HEIGHT;h++)e=i+s,o=h+r,t.buffer[i+h*t.WIDTH]=this.getPixel(t,e,o);const i=t.pixels;t.pixels=t.buffer,t.buffer=i}getPixel({WIDTH:t,HEIGHT:s,pixels:e},o,r){return o>0&&o<t&&r>0&&r<s?e[o+r*t]:this.color}}class r{constructor(t){this.colors=Array(8);for(let s=0;s<8;s++){const e=4+2*s;let o=(63&t[e])<<6;o+=63&t[e+1];const r=Array(3);r[0]=o>>8,r[1]=(240&o)>>4,r[2]=15&o,this.colors[s]=r}}execute(t){for(let s=0;s<8;s++)t.setCLUTEntry(s+this.clutOffset,this.colors[s][0],this.colors[s][1],this.colors[s][2])}get clutOffset(){return 0}}class i{constructor(t){this.bytes=new Uint8Array(t),this.numPackets=t.byteLength/24,this.pc=-1}parseThrough(t){const s=Math.floor(300*t),e=[];for(this.pc>s&&(this.pc=-1,e.isRestarting=!0);this.pc<s&&this.pc<this.numPackets;){this.pc++;const t=24*this.pc,s=this.parse(this.bytes.slice(t,t+24));s&&e.push(s)}return e}parse(t){if((t[0]&this.COMMAND_MASK)===this.CDG_COMMAND){const s=t[1]&this.COMMAND_MASK,e=this.BY_TYPE[s];return void 0!==e?new e(t):(console.log(`Unknown CDG instruction (instruction = ${s})`),!1)}return!1}}i.prototype.COMMAND_MASK=63,i.prototype.CDG_COMMAND=9,i.prototype.BY_TYPE={1:class{constructor(t){this.color=15&t[4],this.repeat=15&t[5]}execute(t){t.pixels.fill(this.color),t.bgColor=this.color}},2:class{constructor(t){this.color=15&t[4]}execute({DISPLAY_BOUNDS:t,WIDTH:s,pixels:e,HEIGHT:o}){const r=t;for(let t=0;t<s;t++){for(let o=0;o<r[1];o++)e[t+o*s]=this.color;for(let i=r[3]+1;i<o;i++)e[t+i*s]=this.color}for(let t=r[1];t<=r[3];t++){for(let o=0;o<r[0];o++)e[o+t*s]=this.color;for(let o=r[2]+1;o<s;o++)e[o+t*s]=this.color}}},6:e,20:o,24:class extends o{getPixel({WIDTH:t,HEIGHT:s,pixels:e},o,r){return e[(o=(o+t)%t)+(r=(r+s)%s)*t]}},28:class{constructor(t){this.index=15&t[4]}execute(t){t.keyColor=this.index}},30:r,31:class extends r{get clutOffset(){return 8}},38:class extends e{op({pixels:t},s,e){t[s]=t[s]^e}}},t.exports=class{constructor(){this.ctx=new s}load(t){if(!(t instanceof ArrayBuffer))throw new Error("load() expects an ArrayBuffer");this.forceKey=null,this.parser=new i(t)}render(t,s={}){if(!this.parser)throw new Error("load() must be called before render()");if(isNaN(t)||t<0)throw new Error(`Invalid time: ${t}`);const e=this.parser.parseThrough(t),o=!!e.length||!!e.isRestarting||s.forceKey!==this.forceKey;this.forceKey=s.forceKey,e.isRestarting&&this.ctx.init();for(const t of e)t.execute(this.ctx);return o&&this.ctx.renderFrame(s),{imageData:this.ctx.imageData,isChanged:o,backgroundRGBA:this.ctx.backgroundRGBA,contentBounds:this.ctx.contentBounds}}}}},s={};function e(o){var r=s[o];if(void 0!==r)return r.exports;var i=s[o]={exports:{}};return t[o](i,i.exports,e),i.exports}e.n=t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},e.d=(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},e.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),(()=>{"use strict";var t=e(978);new(e.n(t)())})()})();